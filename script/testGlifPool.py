#import web3 
from web3 import Web3

rpc = "https://api.node.glif.io"
calib = "https://api.calibration.node.glif.io/rpc/v1"

w3 = Web3(Web3.HTTPProvider(rpc))

myAddr = ""

tracker = "0x0xe124db4a1ceb754aaad7d7a9bb29dfa365c4add0"

pk = input("Enter private key: ")

glifpool = "0x3d9B87FA76f37e12748162348C86D5294c469c4D"
glifFactory = " 0x526Ab27Af261d28c2aC1fD24f63CcB3bd44D50e0"
# 0x0000000000000000000000003d9B87FA76f37e12748162348C86D5294c469c4D
ownerSig = "0x8da5cb5b"
registerSig = "0x8a753951"

minerIds = [
    1847751,
    1858235,
    1872811,
    1882569,
    1889910,
    1909616,
    1917539,
    2251151
]

def encode_array(minerids):
    encoded = f"{len(minerids):064x}"

    for value in minerids:
        encoded += f"{value:064x}"

    return encoded

# convert all of the minerIds to hex
minerIds = encode_array(minerIds)

# 0000000000000000000000000000000000000000000000000000000000000008
# 00000000000000000000000000000000000000000000000000000000001c31c7
# 00000000000000000000000000000000000000000000000000000000001c5abb
# 00000000000000000000000000000000000000000000000000000000001c93ab
# 00000000000000000000000000000000000000000000000000000000001cb9c9
# 00000000000000000000000000000000000000000000000000000000001cd676
# 00000000000000000000000000000000000000000000000000000000001d2370
# 00000000000000000000000000000000000000000000000000000000001d4263
# 000000000000000000000000000000000000000000000000000000000022598f

data = ownerSig + glifpool[2:].zfill(64) + "0x40"[2:].zfill(64) + minerIds
# 0x8da5cb5b
# 0000000000000000000000003d9B87FA76f37e12748162348C86D5294c469c4D
# 0000000000000000000000000000000000000000000000000000000000000040
# 0000000000000000000000000000000000000000000000000000000000000008
# 00000000000000000000000000000000000000000000000000000000001c31c7
# 00000000000000000000000000000000000000000000000000000000001c5abb
# 00000000000000000000000000000000000000000000000000000000001c93ab
# 00000000000000000000000000000000000000000000000000000000001cb9c9
# 00000000000000000000000000000000000000000000000000000000001cd676
# 00000000000000000000000000000000000000000000000000000000001d2370
# 00000000000000000000000000000000000000000000000000000000001d4263
# 000000000000000000000000000000000000000000000000000000000022598f

nonce = w3.eth.get_transaction_count(myAddr)
tx = {
    "to": w3.toChecksumAddress(tracker),
    "data": data,
    "gas": 100000000,
    "maxFeePerGas": w3.toWei('100', 'gwei'),
    "maxPriorityFeePerGas": w3.toWei('1', 'gwei'),
    "chainId": 314159,
    "nonce": nonce,
}

signed = w3.eth.account.sign_transaction(tx, pk)
hash = w3.eth.send_raw_transaction(signed.rawTransaction)
print(hash.hex())
w3.eth.wait_for_transaction_receipt(hash)
print("confirmed")
